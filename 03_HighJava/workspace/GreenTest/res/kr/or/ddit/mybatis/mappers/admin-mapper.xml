<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
	
	<!-- 회원 탈퇴-->
	<update id="memDelete" parameterType="String">
		   UPDATE MEMBER
              SET MEM_LEAVEYN = 'Y'
            WHERE MEM_ID = #{mem_id}
	</update>
	
	<!-- 회원수  -->
	<select id="memCount" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM MEMBER
		where MEM_LEAVEYN = 'N'
	</select>
	
	
	<!-- ==== 회원관리 페이징 처리  ========================================================== -->
	<!-- 동적쿼리 -->
	<sql id="dynamicCondition">
	    <!-- <where>  -->
	      <if test="!(stype == '' or sword == '')">
	         and ${stype} LIKE '%${sword}%'
	       </if>
	    <!-- </where> --> 
	</sql>
	<sql id="dynamicCondition2">
	      <if test="!(stype == '' or sword == '')">
	     <where>  
	         and ${stype} LIKE '%${sword}%'
	     </where> 
	       </if>
	</sql>
	
	<!-- 검색 회원 총원 -->
	 <select id="memSelectCount" parameterType="map" resultType="int">
		select count(*)
		  from MEMBER	
		   <include refid="dynamicCondition2"/>  
	</select> 
	
	<!-- 회원 통합(검색) 조회 -->
	<select id="memList" parameterType="map" resultType="MemberVO">
		select A.* 
		  from (select rownum as rnum , B.* 
		          from (select * 
		                  from MEMBER
		                  where MEM_LEAVEYN = 'N'
	                       <include refid="dynamicCondition"/> 	                     
	                     order by  MEM_NAME desc ) B
	     <![CDATA[ 
	             where rownum <= #{end} ) A
	             where A.rnum >= #{start} 
	     ]]>
	</select>
	<!-- ============================================================================ -->
	
	
	<!-- 게시글 삭제-->
	<update id="postDelete" parameterType="String">
		   UPDATE POST
              SET POST_DELYN = 'Y'
            WHERE POST_NO = #{post_no}
	</update>
	
	<!-- 게시글수  -->
	<select id="postCount" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM POST
		where MEM_LEAVEYN = 'N'
	</select>
	
	<!-- ==== 게시글 관리 페이징 처리  ========================================================== -->
	<!-- 동적쿼리 -->
	<sql id="dynamicCondition1">
	   <!-- <where> -->
	      <if test="!(stype == '' or sword == '')">
	         and ${stype} LIKE '%${sword}%'
	       </if>
	  <!--  </where> -->
	</sql>
	<sql id="dynamicCondition3">
	      <if test="!(stype == '' or sword == '')">
	     <where>  
	         and ${stype} LIKE '%${sword}%'
	     </where> 
	       </if>
	</sql>
	
	
	<!-- 검색 게시글  총갯수 -->
	 <select id="postSelectCount" parameterType="map" resultType="int">
		select count(*)
		  from POST
		  <include refid="dynamicCondition3"/>
	</select> 
	
	<!-- 회원 통합(검색) 조회 -->
	<select id="postList" parameterType="map" resultType="PostVO">
		select A.* 
		  from (select rownum as rnum , B.* 
		          from (select * 
		                  from POST
		                  where POST_DELYN = 'N'
	                      <include refid="dynamicCondition1"/>
	                     order by  POST_NO desc ) B
	     <![CDATA[ 
	             where rownum <= #{end} ) A
	             where A.rnum >= #{start} 
	     ]]>
	</select>
	<!-- ============================================================================ -->
	
	
	
</mapper>

